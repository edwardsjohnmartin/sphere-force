<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="./font-awesome-4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="force-style.css">
    <!--style>
    </style-->
  
  <!------------------------------------------------------------>
  <!------------------------ Line shaders ---------------------->
  <!------------------------------------------------------------>

  <script id="line-vshader" type="x-shader/x-vertex">
    
    attribute vec4 vPosition;
    attribute vec4 vColor;
    varying vec4 fColor;
    
    uniform mat4 mvMatrix;
    uniform mat4 pMatrix;
    
    void main() {
      gl_Position = pMatrix*mvMatrix*vPosition;
      fColor = vColor;
    } 
  </script>
  
  <script id="line-fshader" type="x-shader/x-fragment">
    
    #ifdef GL_ES
    precision highp float;
    #endif
    
    varying vec4 fColor;
    
    void main() {
      gl_FragColor = fColor;
    }
  </script>
  
  <!------------------------------------------------------------>
  <!---------------------- Sphere shaders ---------------------->
  <!------------------------------------------------------------>

  <script id="sphere-vshader" type="x-shader/x-vertex">
    attribute vec4 vPosition;
    attribute vec4 vNormal;
    attribute vec4 vColor;
    varying vec4 fColor;
    varying vec3 vLighting;
    varying vec4 gPosition;
    varying vec4 lPosition;
    
    uniform mat4 mvMatrix;
    uniform mat4 pMatrix;
    uniform mat4 nMatrix;
    
    void main() {
      gl_Position = pMatrix*mvMatrix*vPosition;
      gPosition = gl_Position;
      lPosition = vPosition;
      fColor = vColor;
    } 
  </script>

  <script id="sphere-fshader" type="x-shader/x-fragment">
    
    precision highp float;
    
    varying vec4 fColor;
    varying vec3 vLighting;
    varying vec4 gPosition;
    varying vec4 lPosition;
    
    uniform mat4 mvMatrix;
    uniform mat4 pMatrix;
    uniform mat4 nMatrix;

    void main() {
      vec4 vNormal = vec4(lPosition.xyz, 1.0);

      // Change to white if desired
      vec4 lColor = fColor;
      // vec4 lColor = vec4(1.0, 1.0, 1.0, 1.0);

      // Material properties
      vec3 ka = vec3(0.3, 0.3, 0.3) * lColor.xyz;
      vec3 kd = vec3(0.7, 0.7, 0.7) * lColor.xyz;
      //vec3 ks = vec3(0.5, 0.5, 0.5);
      vec3 ks = vec3(0.0, 0.0, 0.0);

      // Light colors
      vec3 La = vec3(1.0, 1.0, 1.0);
      vec3 Ld = vec3(1.0, 1.0, 1.0);
      vec3 Ls = vec3(1.0, 1.0, 1.0);

      // Set the light position
      vec3 lightPosition = vec3(10, 10, 50);

      // Light direction in eye coordinates
      // vec3 l = lightPosition - gl_Position.xyz;
      vec3 l = lightPosition - gPosition.xyz;
      l = normalize(l);

      // normal in eye coordinates
      vec3 n = normalize((nMatrix * vNormal).xyz);

      // specular values
      float alpha = 10.0;
      // vec3 v = normalize(vec3(0.0, 0.0, 10.0) - gl_Position.xyz);
      vec3 v = normalize(vec3(0.0, 0.0, 10.0) - gPosition.xyz);
      vec3 r = max(dot(l, n), 0.0)*n*vec3(2.0, 2.0, 2.0)-l;

      vec3 ambient = ka*La;
      vec3 diffuse = kd*Ld*max(dot(n, l), 0.0);
      vec3 specular = ks*Ls*max(pow(max(dot(r,v), 0.0), alpha), 0.0);

      vec3 lcolor = ambient + diffuse + specular;
      // vec4 fColor = vec4(lcolor, vColor.a);
      vec4 fColor = vec4(lcolor, 1.0);


      //gl_FragColor = vec4(fColor.xyz * vLighting, fColor.a);
      //gl_FragColor = vec4(vLighting, fColor.a);
      gl_FragColor = fColor;
    }
  </script>
  
  <!------------------------------------------------------------>
  <!---------------------- Circle shaders ---------------------->
  <!------------------------------------------------------------>

  <script id="circle-vshader" type="x-shader/x-vertex">
    attribute vec4 vPosition;
    varying vec3 vLighting;
    varying vec4 gPosition;
    varying vec4 lPosition;
    
    uniform mat4 mvMatrix;
    uniform mat4 pMatrix;
    uniform mat4 nMatrix;
    
    void main() {
      gl_Position = pMatrix*mvMatrix*vPosition;
      gPosition = gl_Position;
      lPosition = vPosition;
    } 
  </script>

  <script id="circle-fshader" type="x-shader/x-fragment">
    
    precision highp float;
    
    varying vec3 vLighting;
    varying vec4 gPosition;
    varying vec4 lPosition;
    
    uniform mat4 mvMatrix;
    uniform mat4 pMatrix;
    uniform mat4 nMatrix;

    uniform vec4 color;

    void main() {
      float z = sqrt(1.0 - lPosition.x*lPosition.x - lPosition.y*lPosition.y);
      vec4 vNormal = vec4(lPosition.xy, z, 1.0);

      // Change to white if desired
      // vec4 lColor = fColor;
      // vec4 lColor = vec4(1.0, 1.0, 1.0, 1.0);

      vec4 lColor = color;
      //if (lPosition.x > 0.0) {
        //lColor = vec4(1.0, 0.0, 0.0, 1.0);
      //} else {
        //lColor = vec4(0.0, 0.0, 1.0, 1.0);
      //}

      // Material properties
      vec3 ka = vec3(0.3, 0.3, 0.3) * lColor.xyz;
      vec3 kd = vec3(0.7, 0.7, 0.7) * lColor.xyz;
      //vec3 ks = vec3(0.5, 0.5, 0.5);
      vec3 ks = vec3(0.0, 0.0, 0.0);

      // Light colors
      vec3 La = vec3(1.0, 1.0, 1.0);
      vec3 Ld = vec3(1.0, 1.0, 1.0);
      vec3 Ls = vec3(1.0, 1.0, 1.0);

      // Set the light position
      vec3 lightPosition = vec3(10, 10, 50);

      // Light direction in eye coordinates
      // vec3 l = lightPosition - gl_Position.xyz;
      vec3 l = lightPosition - gPosition.xyz;
      l = normalize(l);

      // normal in eye coordinates
      vec3 n = normalize((nMatrix * vNormal).xyz);

      // specular values
      float alpha = 10.0;
      // vec3 v = normalize(vec3(0.0, 0.0, 10.0) - gl_Position.xyz);
      vec3 v = normalize(vec3(0.0, 0.0, 10.0) - gPosition.xyz);
      vec3 r = max(dot(l, n), 0.0)*n*vec3(2.0, 2.0, 2.0)-l;

      vec3 ambient = ka*La;
      vec3 diffuse = kd*Ld*max(dot(n, l), 0.0);
      vec3 specular = ks*Ls*max(pow(max(dot(r,v), 0.0), alpha), 0.0);

      vec3 lcolor = ambient + diffuse + specular;
      // vec4 fColor = vec4(lcolor, vColor.a);
      vec4 fColor = vec4(lcolor, 1.0);


      //gl_FragColor = vec4(fColor.xyz * vLighting, fColor.a);
      //gl_FragColor = vec4(vLighting, fColor.a);
      gl_FragColor = fColor;
      // gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }
  </script>
  
  <!------------------------------------------------------------>
  <!---------------------- Flat shaders ---------------------->
  <!------------------------------------------------------------>

  <script id="flat-vshader" type="x-shader/x-vertex">
    attribute vec4 vPosition;
    
    uniform mat4 mvMatrix;
    uniform mat4 pMatrix;
    
    void main() {
      gl_Position = pMatrix*mvMatrix*vPosition;
    } 
  </script>

  <script id="flat-fshader" type="x-shader/x-fragment">
    precision highp float;
    uniform vec4 color;
    void main() {
      gl_FragColor = color;
    }
  </script>
  
  <!------------------------------------------------------------>
  <!---------------------- Texture shaders --------------------->
  <!------------------------------------------------------------>

  <script id="tex-vshader" type="x-shader/x-vertex">
    attribute  vec4 vPosition;
    attribute  vec4 vColor;
    attribute  vec2 vTexCoord;

    varying vec4 fColor;
    varying vec2 fTexCoord;

    uniform mat4 pMatrix;
    uniform mat4 mvMatrix;

    void main() {
      fColor = vColor;
      fTexCoord = vTexCoord;
      gl_Position = pMatrix * mvMatrix * vPosition;
    }
  </script>

  <script id="tex-fshader" type="x-shader/x-fragment">
    precision mediump float;

    varying vec4 fColor;
    varying  vec2 fTexCoord;

    uniform sampler2D texture;

    void main() {
      float bias = 0.7;
      gl_FragColor = vec4(bias, bias, bias, 0.0) + texture2D( texture, fTexCoord );
      // gl_FragColor = texture2D( texture, fTexCoord );
      // gl_FragColor = fColor * texture2D( texture, fTexCoord );
      // gl_FragColor = vec4(1.0, 1.0, 0.3, 1.0) * texture2D( texture, fTexCoord );
      // gl_FragColor = texture2D( texture, fTexCoord );
    }
  </script>

  <!------------------------------------------------------------>
  <!------------------------- Javascript ----------------------->
  <!------------------------------------------------------------>

  <script type="text/javascript" src="./common/webgl-utils.js"></script>
  <script type="text/javascript" src="./common/initShaders.js"></script>
  <script type="text/javascript" src="./common/MV.js"></script>

  <script type="text/javascript" src="programs.js"></script>
  <script type="text/javascript" src="axis.js"></script>
  <script type="text/javascript" src="sphere.js"></script>
  <script type="text/javascript" src="circle.js"></script>
  <script type="text/javascript" src="sin2.js"></script>
  <script type="text/javascript" src="forceArrow.js"></script>
  <script type="text/javascript" src="bArrow.js"></script>
  <script type="text/javascript" src="torqueArrow.js"></script>
  <script type="text/javascript" src="square.js"></script>
  <script type="text/javascript" src="floor.js"></script>
  <script type="text/javascript" src="arrow.js"></script>
  <script type="text/javascript" src="segment.js"></script>
  <script type="text/javascript" src="force.js"></script>
  
  </head>

  <body>
    <!--canvas id="gl-canvas" width="512" height="512"-->
    <img id = "dipoleImage" src = "dipole.png" hidden></img>
    <img id = "dipoleFieldImage" src = "dipole-field.png" hidden></img>
    <canvas id="gl-canvas">
      Oops ... your browser doesn't support the HTML5 canvas element
    </canvas>

    <!-- Debug output -->
    <div id="debug" class="debug"></div>

    <!-- Settings -->
    <div id="settings" class="settings">
      <table border="0">
        <tr>
          <td align="right">(x,y):</td>
          <td>
            (<input
                  type="text"
                  class="number"
                  id="x"
                  value="2"
                  step="0.25"
                  onchange="x0Changed()">,
            <input
               type="text"
               class="number"
               id="y"
               value="0"
               step="0.25"
               onchange="y0Changed()">)
          </td>
        </tr>
        <tr>
          <td align="right">Moment:</td>
          <td><input
                 type="text"
                 class="number"
                 id="degrees"
                 value="0"
                 onchange="moment0Changed()"> degrees
          </td>
        </tr>
        <tr>
          <td align="right">Force eddy:</td>
          <td><input
                 type="text"
                 class="number"
                 id="fEddy"
                 onchange="fEddyChanged()"
                 value="0.01"/>
          </td>
        </tr>
        <tr>
          <td align="right">Torque eddy:</td>
          <td><input
                 type="text"
                 class="number"
                 id="tEddy"
                 onchange="tEddyChanged()"
                 value="0.01"/>
          </td>
        </tr>
        <tr>
          <td align="right">Force friction:</td>
          <td><input
                 type="text"
                 class="number"
                 id="fFriction"
                 onchange="fFrictionChanged()"
                 value="0.005"/>
          </td>
        </tr>
        <tr>
          <td align="right">Torque friction:</td>
          <td><input
                 type="text"
                 class="number"
                 id="tFriction"
                 onchange="tFrictionChanged()"
                 value="0.005"/>
          </td>
        </tr>
        <tr>
          <td align="right">Collisions:</td>
          <td><select
                 id="collisionType"
                 value="1"
                 onchange="collisionTypeChanged()">
              <option value="0" selected="selected">Elastic</option>
              <option value="1">Inelastic</option>
            </select>
          </td>
        </tr>
        <tr>
          <td align="right">Simulation speed (dt):</td>
          <td><input
                 type="text"
                 class="number"
                 id="simSpeed"
                 onchange="simSpeedChanged()"
                 value="2.9"
                 step="1"/>x10<sup>-4</sup>
          </td>
        </tr>
        <!--tr>
          <td align="right">Animation speed:</td>
          <td><input
                 type="text"
                 class="number"
                 id="animSpeed"
                 value="500"
                 step="1" hidden/>
          </td>
        </tr-->
        <tr>
          <td colspan="2" align="center">
            <label>
              <input
                 type="checkbox"
                 id="updateP"
                 onclick="transRotClicked()"
                 onfocus="removeFocus()"
                 checked>Translate
            </label>
            <label>
              <input
                 type="checkbox"
                 id="updateM"
                 onclick="transRotClicked()"
                 onfocus="removeFocus()"
                 checked>Rotate<br>
            </label>
          </td>
      </table>

    </div>

    <!-- Control buttons -->
    <div id="controls" class="controls">      
      <button
         type="button"
         class="cbutton"
         onclick="zoomIn()"
         onfocus="removeFocus()"
         title="zoom in (+)">
        <font size="6"><i class="fa fa-search-plus"></i></font></button>
      <br>
      <button
         type="button"
         class="cbutton"
         onclick="zoomOut()"
         onfocus="removeFocus()"
         title="zoom out (-)">
        <font size="6"><i class="fa fa-search-minus"></i></font></button>
      <br>
      <br>

      <button
         type="button"
         class="cbutton"
         id="reset"
         onclick="resetClicked()"
         onfocus="removeFocus()"
         title="reset position (r)">
        <font size="6"><i class="fa fa-refresh"></i></font></button>
      <br>
      <button
         type="button"
         class="cbutton"
         id="play"
         onclick="toggleAnimate()"
         onfocus="removeFocus()"
         title="play/pause animation (spacebar)">
        <font size="6"><i class="fa fa-play"></i></font></button>

    </div>
    
    <div id="logo" class="logo">
      Mag<i>Phyx</i>
    </div>

  </body>
</html>
